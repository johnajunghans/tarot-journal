---
alwaysApply: true
---

# Tarot Journal - Cursor Rules

These rules define the organizational principles and conventions for this codebase.
Follow these guidelines when adding new features or modifying existing code.

---

## Directory Structure

```
src/
├── app/                    # Next.js App Router pages
│   ├── api/                # API routes
│   └── [page]/             # Page components
├── components/
│   ├── context/            # React context providers
│   ├── ui/                 # shadcn/ui base components (do not modify)
│   └── *.tsx               # Application-specific components
└── lib/
    ├── types.ts            # Shared TypeScript types and interfaces
    ├── utils.ts            # General utility functions
    └── *.ts                # Domain-specific utilities and data
```

---

## Component Organization

### File Structure
- **One component per file** - Each component lives in its own file
- **Flat structure with clear naming** - Use descriptive names like `card-picker.tsx`, not nested folders
- **Context providers** - Place in `components/context/`

### Component File Template
```typescript
/**
 * Component Name
 * 
 * Brief description of what this component does.
 */
"use client"  // Only if needed

import { ... } from "..."

// === Types ===

interface ComponentProps {
    // ...
}

// === Component ===

export function Component({ ... }: ComponentProps) {
    // === State ===
    
    // === Derived State ===
    
    // === Event Handlers ===
    
    // === Render ===
    return (...)
}
```

---

## Library/Utility Organization

### When to Extract Utilities
Extract code into `lib/` when:
1. **Shared logic** - Used by multiple components
2. **Complex algorithms** - Non-trivial logic that deserves isolation
3. **Configuration data** - Constants and configs used across the app
4. **Domain logic** - Business rules separate from UI

### Utility File Template
```typescript
/**
 * Utility Name
 * 
 * Brief description of this module's purpose.
 */
import { ... } from "..."

// === Constants ===

export const SOME_CONSTANT = ...

// === Types ===

export interface SomeType { ... }

// === Helpers ===

/** Brief description of function */
export function helperFunction() { ... }
```

### Domain-Specific Modules
- `tarot-data.ts` - Card definitions, lookups, formatting
- `spread-config.ts` - Spread definitions, positions, descriptions
- `card-search.ts` - Search algorithm and token expansion
- `storage.ts` - localStorage persistence layer

---

## Commenting Standards

### File-Level Comments
Every file should start with a JSDoc comment:
```typescript
/**
 * Module/Component Name
 * 
 * Brief description (1-3 sentences) of purpose.
 */
```

### Section Comments
Use section headers to organize code within files:
```typescript
// === Constants ===
// === Types ===
// === Helpers ===
// === Component ===
// === State ===
// === Event Handlers ===
// === Render ===
```

### Function Documentation
Document non-obvious functions with JSDoc:
```typescript
/**
 * Brief description of what the function does.
 * 
 * @param paramName - Description of parameter
 * @returns Description of return value
 */
```

---

## Naming Conventions

### Files
- **Components**: `kebab-case.tsx` (e.g., `card-picker.tsx`)
- **Utilities**: `kebab-case.ts` (e.g., `card-search.ts`)
- **Types only**: `types.ts` in `lib/`

### Exports
- **Components**: PascalCase (e.g., `CardPicker`)
- **Functions**: camelCase (e.g., `getCardById`)
- **Constants**: SCREAMING_SNAKE_CASE (e.g., `SPREAD_POSITIONS`)
- **Types/Interfaces**: PascalCase (e.g., `ReadingCard`)

---

## Import Order

Organize imports in this order, with blank lines between groups:
1. External packages (react, next, lucide-react, etc.)
2. Internal lib imports (`@/lib/*`)
3. Internal component imports (`@/components/*`)
4. Relative imports (`./`)

---

## UI Components

### shadcn/ui Components
- Located in `components/ui/`
- **Do not modify** - These are generated by shadcn CLI
- Extend via composition, not modification

### Application Components
- Build on top of shadcn primitives
- Keep styling consistent with existing patterns
- Use `cn()` utility for conditional class merging

---

## State Management

### Client State
- Use React hooks (`useState`, `useMemo`, `useCallback`)
- Extract complex state logic into custom hooks when reused

### Persistence
- Use `lib/storage.ts` for localStorage operations
- All storage functions handle SSR gracefully

---

## Spread/Card Domain Rules

### Position Numbering
- Positions are **1-indexed** (not 0-indexed)
- Use helper functions from `spread-config.ts`:
  - `getPositionLabel(type, position)`
  - `getPositionDescription(type, position)`

### Card Lookups
- Use `getCardById()` from `tarot-data.ts` instead of `cards.find()`
- Use `formatCardName()` for display-friendly card names

---

## Code Style

### TypeScript
- Prefer explicit types over `any`
- Use interfaces for object shapes, types for unions
- Export types that might be reused

### React
- Prefer function components with hooks
- Use `"use client"` directive only when necessary
- Memoize expensive computations with `useMemo`

